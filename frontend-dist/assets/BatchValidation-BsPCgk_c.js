import{c as se,u as ge,r,b as T,j as e,D as Ne,C as V,X as je,a as me,d as ue,e as he,F as ye,S as ke,f as D,m as z,g as we,T as ie,A as pe,h as Se,M as _e,i as ce,k as Ce,l as ve,n as fe,R as Ee}from"./index-BuVMdbAI.js";/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=se("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=se("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=se("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=se("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Me=1e3,Fe=[".csv",".tsv",".txt"],be=t=>{const s=t.toLowerCase();return Fe.some(u=>s.endsWith(u))};function Pe({onUploadSuccess:t,onUploadError:s,disabled:u=!1}){const i=ge(),[g,y]=r.useState(!1),[o,n]=r.useState(null),[b,k]=r.useState(!1),[m,f]=r.useState(!1),[v,d]=r.useState(!1),[_,w]=r.useState(0),[x,S]=r.useState(null),[c,h]=r.useState(""),[p,$]=r.useState(""),[O,I]=r.useState(!1),[U,J]=r.useState(!1),[X,ee]=r.useState(!1),a=r.useRef(null),L=x&&x.row_count_estimate>Me,R=o==null?void 0:o.name.toLowerCase().endsWith(".sdf"),Z=r.useCallback(l=>{l.preventDefault(),l.stopPropagation(),y(!0)},[]),Q=r.useCallback(l=>{l.preventDefault(),l.stopPropagation(),y(!1)},[]),K=r.useCallback(l=>{l.preventDefault(),l.stopPropagation()},[]),H=r.useCallback(l=>{const E=l.name.toLowerCase();return!E.endsWith(".sdf")&&!be(E)?"Invalid file type. Please upload an SDF, CSV, TSV, or TXT file.":l.size>i.max_file_size_bytes?`File too large. Maximum size is ${i.max_file_size_mb}MB.`:null},[i.max_file_size_bytes,i.max_file_size_mb]),B=r.useCallback(async l=>{const E=H(l);if(E){s(E);return}if(n(l),S(null),h(""),$(""),be(l.name)){k(!0);try{const M=await T.detectColumnsLocal(l);S(M),h(M.suggested_smiles||M.columns[0]||""),$(M.suggested_name||"")}catch(M){const A=M.message||"Failed to read file columns";s(A),n(null)}finally{k(!1)}}},[s,H]),N=r.useCallback(async l=>{if(l.preventDefault(),l.stopPropagation(),y(!1),u||v||b||m)return;const E=l.dataTransfer.files;E.length>0&&await B(E[0])},[u,v,b,m,B]),C=r.useCallback(async l=>{const E=l.target.files;E&&E.length>0&&await B(E[0])},[B]),F=async()=>{var l,E;if(!(!o||v||m)){if(x&&!c){s("Please select the SMILES column");return}try{let M=o,A=c,q=p;if(x&&c&&x.columns.length>3&&o.size<5*1024*1024){f(!0);try{M=await T.extractColumns(o,c,p||void 0),A="SMILES",q=p?"Name":""}catch(P){console.warn("Column extraction failed, uploading full file:",P),M=o,A=c,q=p}finally{f(!1)}}d(!0),w(0);const j=await T.uploadBatch(M,x?A:void 0,x&&q?q:void 0,P=>w(P),{includeExtended:O,includeChembl:U,includeStandardization:X});t(j.job_id,j.total_molecules)}catch(M){const A=((E=(l=M.response)==null?void 0:l.data)==null?void 0:E.detail)||M.message||"Upload failed";s(A)}finally{f(!1),d(!1)}}},Y=()=>{n(null),S(null),h(""),$(""),f(!1),w(0),a.current&&(a.current.value="")},ae=l=>l<1024?`${l} B`:l<1024*1024?`${(l/1024).toFixed(1)} KB`:`${(l/(1024*1024)).toFixed(1)} MB`;return e.jsxs("div",{className:"space-y-4",children:[!o&&e.jsxs("div",{onDragEnter:Z,onDragLeave:Q,onDragOver:K,onDrop:N,onClick:()=>{var l;return!u&&!v&&((l=a.current)==null?void 0:l.click())},className:`
            border-2 border-dashed rounded-xl p-8 text-center cursor-pointer
            transition-all duration-200
            ${g?"border-[var(--color-primary)] bg-[var(--color-primary)]/10 scale-[1.02]":"border-[var(--color-border-strong)] hover:border-[var(--color-text-muted)] hover:bg-[var(--color-surface-sunken)]/50"}
            ${u||v?"opacity-50 cursor-not-allowed":""}
          `,children:[e.jsx("input",{ref:a,type:"file",accept:".sdf,.csv,.tsv,.txt",onChange:C,className:"hidden",disabled:u||v}),e.jsxs("div",{className:"text-[var(--color-text-secondary)]",children:[e.jsx("div",{className:"mx-auto w-16 h-16 rounded-2xl bg-gradient-to-br from-[var(--color-primary)]/10 to-[var(--color-accent)]/10 flex items-center justify-center mb-4",children:e.jsx(xe,{className:"w-8 h-8 text-[var(--color-primary)]"})}),e.jsx("p",{className:"text-lg font-medium text-[var(--color-text-primary)]",children:g?"Drop file here":"Drop file here or click to browse"}),e.jsxs("p",{className:"text-sm text-[var(--color-text-muted)] mt-2",children:["Supports ",e.jsx("span",{className:"font-medium",children:"SDF"}),", ",e.jsx("span",{className:"font-medium",children:"CSV"}),", ",e.jsx("span",{className:"font-medium",children:"TSV"}),", and ",e.jsx("span",{className:"font-medium",children:"TXT"})," files"]}),e.jsxs("p",{className:"text-xs text-[var(--color-text-muted)] mt-1",children:["Up to ",i.max_batch_size.toLocaleString()," molecules â€¢ Max ",i.max_file_size_mb,"MB"]})]})]}),b&&e.jsxs("div",{className:"bg-[var(--color-surface-sunken)] rounded-xl p-6 text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-[var(--color-primary)] border-t-transparent rounded-full mx-auto mb-3"}),e.jsx("p",{className:"text-[var(--color-text-secondary)]",children:"Analyzing file..."})]}),o&&!b&&e.jsxs("div",{className:"bg-[var(--color-surface-elevated)] rounded-xl border border-[var(--color-border)] overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-[var(--color-border)] bg-[var(--color-surface-sunken)]/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-[var(--color-primary)]/10 to-[var(--color-accent)]/10 flex items-center justify-center",children:R?e.jsx(Ne,{className:"w-5 h-5 text-[var(--color-primary)]"}):e.jsx(re,{className:"w-5 h-5 text-[var(--color-primary)]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-[var(--color-text-primary)]",children:o.name}),e.jsxs("p",{className:"text-sm text-[var(--color-text-muted)]",children:[ae(o.size),x&&e.jsxs(e.Fragment,{children:[" â€¢ ",e.jsxs("span",{className:"text-[var(--color-primary)] font-medium",children:["~",x.row_count_estimate.toLocaleString()," molecules"]})," â€¢ ",x.columns.length," columns"]})]})]})]}),e.jsx(V,{variant:"ghost",size:"icon",onClick:Y,disabled:v,children:e.jsx(je,{className:"h-5 w-5"})})]})}),x&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-[var(--color-surface-sunken)]",children:[e.jsx(me,{className:"w-4 h-4 text-[var(--color-primary)] mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-[var(--color-text-secondary)]",children:[e.jsx("p",{children:"Select the columns that contain your molecular data:"}),e.jsxs("ul",{className:"mt-1 ml-4 list-disc text-xs text-[var(--color-text-muted)]",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"SMILES column"})," - Required: Contains the molecular structure"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Name/ID column"})," - Optional: Contains molecule identifiers"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-2",children:["SMILES Column ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:c,onChange:l=>h(l.target.value),disabled:v,className:"w-full appearance-none border border-[var(--color-border)] bg-[var(--color-surface-elevated)] text-[var(--color-text-primary)] rounded-lg px-4 py-2.5 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select SMILES column..."}),x.columns.map(l=>e.jsxs("option",{value:l,children:[l,l===x.suggested_smiles?" (suggested)":"",x.column_samples[l]?` - e.g., "${x.column_samples[l]}"`:""]},l))]}),e.jsx(ue,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[var(--color-text-muted)] pointer-events-none"})]}),c&&x.column_samples[c]&&e.jsxs("p",{className:"mt-1 text-xs text-[var(--color-text-muted)]",children:["Sample: ",e.jsx("code",{className:"bg-[var(--color-surface-sunken)] px-1 py-0.5 rounded",children:x.column_samples[c]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-2",children:["Name/ID Column ",e.jsx("span",{className:"text-[var(--color-text-muted)] font-normal",children:"(optional)"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:p,onChange:l=>$(l.target.value),disabled:v,className:"w-full appearance-none border border-[var(--color-border)] bg-[var(--color-surface-elevated)] text-[var(--color-text-primary)] rounded-lg px-4 py-2.5 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] focus:border-transparent",children:[e.jsx("option",{value:"",children:"Auto-detect or none"}),x.columns.filter(l=>l!==c).map(l=>e.jsxs("option",{value:l,children:[l,l===x.suggested_name?" (suggested)":"",x.column_samples[l]?` - e.g., "${x.column_samples[l]}"`:""]},l))]}),e.jsx(ue,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[var(--color-text-muted)] pointer-events-none"})]}),p&&x.column_samples[p]&&e.jsxs("p",{className:"mt-1 text-xs text-[var(--color-text-muted)]",children:["Sample: ",e.jsx("code",{className:"bg-[var(--color-surface-sunken)] px-1 py-0.5 rounded",children:x.column_samples[p]})]})]}),L&&e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-amber-500/10 border border-amber-500/20",children:[e.jsx(me,{className:"w-4 h-4 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-amber-600 dark:text-amber-400",children:"Large File Detected"}),e.jsxs("p",{className:"text-amber-600/80 dark:text-amber-400/80 text-xs mt-0.5",children:["This file contains ",x.row_count_estimate.toLocaleString()," molecules and may take several minutes to process."]})]})]}),c&&e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-green-500/10 border border-green-500/20",children:[e.jsx(he,{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:[e.jsxs("p",{children:["Ready to process ~",x.row_count_estimate.toLocaleString()," molecules"]}),x.columns.length>2&&e.jsx("p",{className:"text-xs text-green-600/70 dark:text-green-400/70 mt-1",children:"Only selected columns will be uploaded (faster upload)"})]})]})]}),R&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-green-500/10 border border-green-500/20",children:[e.jsx(he,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-600 dark:text-green-400",children:"SDF file ready to process"})]})})]}),o&&!b&&e.jsxs("div",{className:"bg-[var(--color-surface-elevated)] rounded-xl border border-[var(--color-border)] overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-[var(--color-border)] bg-[var(--color-surface-sunken)]/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-[var(--color-primary)]"}),e.jsx("p",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:"Standardization"})]}),e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] mt-1",children:"Optionally run the ChEMBL standardization pipeline on each molecule before validation."})]}),e.jsx("div",{className:"p-4",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:X,onChange:l=>ee(l.target.checked),disabled:v,className:"mt-1 h-4 w-4 rounded border-[var(--color-border)] text-[var(--color-primary)] focus:ring-[var(--color-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-[var(--color-text-primary)] group-hover:text-[var(--color-primary)] transition-colors",children:"Enable ChEMBL Standardization"}),e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] mt-0.5",children:"Normalizes structures using the ChEMBL pipeline: fixes nitro groups, removes salts and solvents, standardizes charge states, and extracts the parent molecule. Results will show the standardized SMILES alongside the original."})]})]})})]}),o&&!b&&e.jsxs("div",{className:"bg-[var(--color-surface-elevated)] rounded-xl border border-[var(--color-border)] overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-[var(--color-border)] bg-[var(--color-surface-sunken)]/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-[var(--color-primary)]"}),e.jsx("p",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:"Safety Screening"})]}),e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] mt-1",children:"All molecules are screened against PAINS and Brenk filters by default. Enable additional filters below for more comprehensive screening."})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:l=>I(l.target.checked),disabled:v,className:"mt-1 h-4 w-4 rounded border-[var(--color-border)] text-[var(--color-primary)] focus:ring-[var(--color-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-[var(--color-text-primary)] group-hover:text-[var(--color-primary)] transition-colors",children:"Extended Filters (NIH + ZINC)"}),e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] mt-0.5",children:"NIH/NCGC alerts flag compounds that interfere with high-throughput screening assays. ZINC filters identify reactive or unstable functional groups. Recommended for HTS compound libraries."})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:U,onChange:l=>J(l.target.checked),disabled:v,className:"mt-1 h-4 w-4 rounded border-[var(--color-border)] text-[var(--color-primary)] focus:ring-[var(--color-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-[var(--color-text-primary)] group-hover:text-[var(--color-primary)] transition-colors",children:"ChEMBL Pharma Alerts (7 filter sets)"}),e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] mt-0.5",children:"Structural alerts curated by pharmaceutical companies: Bristol-Myers Squibb, Dundee, GlaxoSmithKline, Inpharmatica, Lilly (LINT), MLSMR, and SureChEMBL. These are aggressive filters designed for drug discovery â€” many flagged compounds may be acceptable outside that context."})]})]})]})]}),o&&!b&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{variant:"primary",size:"lg",onClick:F,disabled:!o||v||m||u||!!(x&&!c),loading:v||m,leftIcon:!v&&!m?e.jsx(xe,{className:"w-5 h-5"}):void 0,className:"w-full",children:m?"Preparing file...":v&&_<100?`Uploading... ${_}%`:v&&_>=100?"Processing on server...":L?`Start Processing ~${x==null?void 0:x.row_count_estimate.toLocaleString()} Molecules`:"Upload and Process"}),v&&_>0&&_<100&&e.jsx("div",{className:"w-full bg-[var(--color-surface-sunken)] rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-[var(--color-primary)] transition-all duration-300",style:{width:`${_}%`}})})]})]})}const ze=r.memo(function({progress:s=0,status:u="processing",className:i}){const g=u==="processing"||u==="pending",y=u==="complete",o=u==="failed"||u==="cancelled",n=2*Math.PI*46,b=n*(1-s/100);return e.jsxs("div",{className:D("relative flex items-center justify-center",i),children:[e.jsx("div",{className:D("absolute inset-0 rounded-full transition-opacity duration-500",g&&"animate-pulse"),style:{background:y?"radial-gradient(circle, rgba(234,179,8,0.3) 0%, transparent 70%)":o?"radial-gradient(circle, rgba(239,68,68,0.3) 0%, transparent 70%)":"radial-gradient(circle, rgba(196,30,58,0.3) 0%, rgba(217,119,6,0.15) 50%, transparent 70%)"}}),g&&e.jsx("div",{className:"absolute w-36 h-36 rounded-full border border-dashed border-[var(--color-primary)]/30 animate-spin",style:{animationDuration:"8s"}}),e.jsxs("svg",{className:"absolute w-32 h-32",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"46",fill:"none",stroke:"currentColor",strokeWidth:"3",className:"text-gray-200 dark:text-gray-700"}),e.jsx("circle",{cx:"50",cy:"50",r:"46",fill:"none",stroke:"url(#progressGradient)",strokeWidth:"4",strokeLinecap:"round",strokeDasharray:n,strokeDashoffset:b,className:"transition-all duration-300 ease-out",style:{transformOrigin:"center",transform:"rotate(-90deg)"}}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"progressGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#c41e3a"}),e.jsx("stop",{offset:"50%",stopColor:"#e11d48"}),e.jsx("stop",{offset:"100%",stopColor:"#d97706"})]})})]}),e.jsxs("div",{className:D("relative w-24 h-24 rounded-full overflow-hidden transition-shadow duration-500",g&&"animate-pulse"),style:{boxShadow:y?"0 0 40px rgba(234,179,8,0.5), 0 0 60px rgba(234,179,8,0.2)":o?"0 0 30px rgba(239,68,68,0.4), 0 0 50px rgba(239,68,68,0.2)":"0 0 25px rgba(196,30,58,0.4), 0 0 50px rgba(217,119,6,0.2)"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent pointer-events-none z-10"}),e.jsx("img",{src:"/logo.png",alt:"ChemAudit",className:"w-full h-full object-cover"})]}),y&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-yellow-400/20 to-amber-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-amber-500",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M5 13l4 4L19 7"})})})}),o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-24 h-24 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-red-500",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})})]})});function $e({progress:t,isConnected:s,onCancel:u,onComplete:i}){const g=(t==null?void 0:t.progress)??0,y=r.useRef(!1);r.useEffect(()=>{(t==null?void 0:t.status)==="complete"&&!y.current&&(y.current=!0,i())},[t==null?void 0:t.status,i]),r.useEffect(()=>{((t==null?void 0:t.status)==="pending"||(t==null?void 0:t.status)==="processing")&&(y.current=!1)},[t==null?void 0:t.status]);const o=f=>{if(f==null||f<=0)return"Calculating...";if(f<60)return`${Math.ceil(f)} seconds`;if(f<3600){const _=Math.floor(f/60),w=Math.ceil(f%60);return`${_}:${w.toString().padStart(2,"0")}`}const v=Math.floor(f/3600),d=Math.floor(f%3600/60);return`${v}:${d.toString().padStart(2,"0")}:00`},n=r.useMemo(()=>{switch(t==null?void 0:t.status){case"complete":return"Processing Complete!";case"failed":return"Processing Failed";case"cancelled":return"Processing Cancelled";case"pending":return"Preparing...";default:return"Processing Molecules"}},[t==null?void 0:t.status]),b=r.useMemo(()=>(t==null?void 0:t.status)==="processing"&&t.processed>0?`${t.processed.toLocaleString()} of ${t.total.toLocaleString()} molecules analyzed`:(t==null?void 0:t.status)==="complete"?`Successfully processed ${t.total.toLocaleString()} molecules`:(t==null?void 0:t.status)==="pending"?"Initializing batch job...":"Connecting to server...",[t==null?void 0:t.status,t==null?void 0:t.processed,t==null?void 0:t.total]),k=r.useMemo(()=>{switch(t==null?void 0:t.status){case"pending":return"Waiting to start...";case"processing":return`Processing ${t.processed} of ${t.total} molecules...`;case"complete":return"Processing complete!";case"failed":return`Failed: ${t.error_message||"Unknown error"}`;case"cancelled":return"Cancelled";default:return"Connecting..."}},[t==null?void 0:t.status,t==null?void 0:t.processed,t==null?void 0:t.total,t==null?void 0:t.error_message]),m=r.useMemo(()=>{let f;return(t==null?void 0:t.status)==="complete"?f="linear-gradient(90deg, #F59E0B, #EAB308, #FBBF24)":(t==null?void 0:t.status)==="failed"?f="linear-gradient(90deg, #EF4444, #DC2626)":f="linear-gradient(90deg, #c41e3a, #e11d48, #d97706)",{background:f}},[t==null?void 0:t.status]);return e.jsxs(z.div,{className:"bg-[var(--color-surface-elevated)] rounded-2xl shadow-lg border border-[var(--color-border)] p-8 space-y-6 overflow-hidden relative",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:[e.jsxs(z.div,{className:"flex flex-col items-center py-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx(ze,{progress:g,status:t==null?void 0:t.status,className:"w-56 h-56 mb-6"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-[var(--color-text-primary)] font-display mb-1",children:n}),e.jsx("p",{className:"text-[var(--color-text-secondary)] text-sm",children:b})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:"Batch Processing"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s?"bg-yellow-500":"bg-[var(--color-text-muted)]"}`}),e.jsx("span",{className:"text-xs text-[var(--color-text-muted)]",children:s?"Connected":"Disconnected"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"h-3 bg-[var(--color-surface-sunken)] rounded-full overflow-hidden relative",children:[(t==null?void 0:t.status)==="processing"&&e.jsx(z.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent",animate:{x:["-100%","100%"]},transition:{duration:1.5,repeat:1/0,ease:"linear"}}),e.jsx("div",{className:"h-full relative overflow-hidden transition-all duration-300 ease-out",style:{width:`${Math.max(0,Math.min(100,g))}%`,...m},children:(t==null?void 0:t.status)==="processing"&&e.jsx(z.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent",animate:{x:["-100%","100%"]},transition:{duration:1,repeat:1/0,ease:"linear"}})})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-[var(--color-text-secondary)]",children:k}),e.jsxs("span",{className:"font-semibold text-[var(--color-text-primary)]",children:[Math.round(g),"%"]})]})]}),t&&t.status==="processing"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 py-4 px-2 border-t border-b border-[var(--color-border)] bg-gradient-to-r from-transparent via-[var(--color-surface-sunken)]/50 to-transparent rounded-lg",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg bg-[var(--color-surface-elevated)] border border-[var(--color-border)]/50",children:[e.jsx("p",{className:"text-2xl font-bold bg-gradient-to-r from-[#c41e3a] to-[#d97706] bg-clip-text text-transparent",children:t.processed.toLocaleString()}),e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] mt-1",children:"Processed"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-[var(--color-surface-elevated)] border border-[var(--color-border)]/50",children:[e.jsx("p",{className:"text-2xl font-bold text-[var(--color-text-primary)]",children:(t.total-t.processed).toLocaleString()}),e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] mt-1",children:"Remaining"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-[var(--color-surface-elevated)] border border-[var(--color-border)]/50",children:[e.jsx("p",{className:"text-2xl font-bold text-amber-500 dark:text-amber-400",children:o(t.eta_seconds)}),e.jsx("p",{className:"text-xs text-[var(--color-text-muted)] mt-1",children:"ETA"})]})]}),(t==null?void 0:t.status)==="failed"&&t.error_message&&e.jsx(z.div,{className:"bg-gradient-to-r from-red-500/10 to-rose-500/10 dark:from-red-500/20 dark:to-rose-500/20 border border-red-500/30 rounded-xl p-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-600 dark:text-red-400",children:"Processing Failed"}),e.jsx("p",{className:"text-sm text-red-500/80 dark:text-red-400/80 mt-1",children:t.error_message})]})]})}),(t==null?void 0:t.status)==="processing"&&e.jsx(V,{variant:"danger",size:"lg",onClick:u,leftIcon:e.jsx(we,{className:"w-5 h-5"}),className:"w-full",children:"Cancel Processing"}),(t==null?void 0:t.status)==="complete"&&e.jsxs(z.div,{className:"bg-gradient-to-r from-yellow-500/10 via-amber-500/10 to-orange-500/10 dark:from-yellow-500/20 dark:via-amber-500/20 dark:to-orange-500/20 border border-yellow-500/30 rounded-xl p-6 text-center",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},children:[e.jsx(z.div,{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-yellow-400 to-amber-500 flex items-center justify-center shadow-lg shadow-yellow-500/30",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,delay:.1},children:e.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M5 13l4 4L19 7"})})}),e.jsxs("p",{className:"text-amber-700 dark:text-yellow-400 font-semibold text-lg font-display",children:["Successfully processed ",t.total.toLocaleString()," molecules!"]}),e.jsx("p",{className:"text-amber-600 dark:text-yellow-500 text-sm mt-2",children:"Loading results..."})]})]})}function Re({jobId:t,isOpen:s,onClose:u,selectedIndices:i}){const[g,y]=r.useState("csv"),[o,n]=r.useState(!1),[b,k]=r.useState(null);if(!s)return null;const m=i&&i.size>0,f=async()=>{n(!0),k(null);try{let d;if(m){const h=Array.from(i).sort((p,$)=>p-$);if(h.length<=200){const p=h.join(","),$=`/api/v1/batch/${t}/export?format=${g}&indices=${p}`;d=await fetch($)}else{const p=`/api/v1/batch/${t}/export?format=${g}`;d=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({indices:h})})}}else{const h=`/api/v1/batch/${t}/export?format=${g}`;d=await fetch(h)}if(!d.ok){const h=await d.json();throw new Error(h.detail||"Export failed")}const _=d.headers.get("Content-Disposition");let w=`batch_${t}.${g}`;if(_){const h=_.match(/filename="?([^"]+)"?/);h&&(w=h[1])}const x=await d.blob(),S=window.URL.createObjectURL(x),c=document.createElement("a");c.href=S,c.download=w,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(S),u()}catch(d){k(d instanceof Error?d.message:"Export failed")}finally{n(!1)}},v=[{value:"csv",label:"CSV",description:"Plain text data - Excel, Google Sheets compatible",icon:"ðŸ“„"},{value:"excel",label:"Excel",description:"Formatted spreadsheet with colors and summary sheet",icon:"ðŸ“Š"},{value:"sdf",label:"SDF",description:"Chemical structure file with attached properties",icon:"ðŸ§ª"},{value:"json",label:"JSON",description:"Programmatic access with full metadata",icon:"{ }"},{value:"pdf",label:"PDF",description:"Professional report with charts and molecule images",icon:"ðŸ“‘"}];return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[var(--color-surface-elevated)] rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto border border-[var(--color-border)]",children:[e.jsxs("div",{className:"border-b border-[var(--color-border)] px-6 py-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text-primary)]",children:"Export Results"}),e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] mt-1",children:m?e.jsxs(e.Fragment,{children:["Export Selected (",i.size," molecules)"]}):e.jsx(e.Fragment,{children:"Choose a format to download batch validation results"})})]}),e.jsx("div",{className:"px-6 py-4 space-y-3",children:v.map(d=>e.jsxs("label",{className:`
                flex items-start p-4 border-2 rounded-lg cursor-pointer
                transition-colors hover:bg-[var(--color-surface-sunken)]
                ${g===d.value?"border-[var(--color-primary)] bg-[var(--color-primary)]/5":"border-[var(--color-border)]"}
              `,children:[e.jsx("input",{type:"radio",name:"format",value:d.value,checked:g===d.value,onChange:_=>y(_.target.value),className:"mt-1 text-[var(--color-primary)] focus:ring-[var(--color-primary)]"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl mr-2",children:d.icon}),e.jsx("span",{className:"font-medium text-[var(--color-text-primary)]",children:d.label})]}),e.jsx("p",{className:"text-sm text-[var(--color-text-secondary)] mt-1",children:d.description})]})]},d.value))}),b&&e.jsx("div",{className:"mx-6 mb-4 p-3 bg-red-500/10 dark:bg-red-500/20 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:b})}),e.jsxs("div",{className:"border-t border-[var(--color-border)] px-6 py-4 flex justify-end space-x-3",children:[e.jsx(V,{variant:"default",onClick:u,disabled:o,children:"Cancel"}),e.jsx(V,{variant:"primary",onClick:f,disabled:o,loading:o,leftIcon:o?void 0:e.jsx(de,{className:"w-4 h-4"}),children:o?"Exporting...":`Download ${g.toUpperCase()}`})]})]})})}function De({jobId:t,statistics:s,selectedIndices:u,onClearSelection:i}){var v,d,_,w,x,S;const[g,y]=r.useState(!1),[o,n]=r.useState(void 0),b=c=>{if(c===null)return"-";if(c<60)return`${c.toFixed(1)}s`;const h=Math.floor(c/60),p=Math.round(c%60);return`${h}m ${p}s`},k=c=>c===null?"text-[var(--color-text-muted)]":c>=80?"text-amber-600 dark:text-yellow-400":c>=50?"text-orange-600 dark:text-orange-400":"text-red-600 dark:text-red-400",m=s.successful,f={excellent:m>0?s.score_distribution.excellent/m*100:0,good:m>0?s.score_distribution.good/m*100:0,moderate:m>0?s.score_distribution.moderate/m*100:0,poor:m>0?s.score_distribution.poor/m*100:0};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-500/10 dark:bg-blue-500/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-700 dark:text-blue-400",children:s.total}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-500",children:"Total Molecules"})]}),e.jsxs("div",{className:"bg-yellow-500/10 dark:bg-yellow-500/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-3xl font-bold text-amber-700 dark:text-yellow-400",children:s.successful}),e.jsx("p",{className:"text-sm text-amber-600 dark:text-yellow-500",children:"Successful"})]}),e.jsxs("div",{className:"bg-red-500/10 dark:bg-red-500/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-3xl font-bold text-red-700 dark:text-red-400",children:s.errors}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-500",children:"Errors"})]}),e.jsxs("div",{className:"bg-purple-500/10 dark:bg-purple-500/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-3xl font-bold text-purple-700 dark:text-purple-400",children:b(s.processing_time_seconds)}),e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-500",children:"Processing Time"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-[var(--color-surface-elevated)] border border-[var(--color-border)] rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] mb-1",children:"Avg Validation"}),e.jsx("p",{className:`text-3xl font-bold ${k(s.avg_validation_score)}`,children:((v=s.avg_validation_score)==null?void 0:v.toFixed(1))??"-"})]}),e.jsxs("div",{className:"bg-[var(--color-surface-elevated)] border border-[var(--color-border)] rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] mb-1",children:"Avg ML-Readiness"}),e.jsx("p",{className:`text-3xl font-bold ${k(s.avg_ml_readiness_score)}`,children:((d=s.avg_ml_readiness_score)==null?void 0:d.toFixed(1))??"-"})]}),e.jsxs("div",{className:"bg-[var(--color-surface-elevated)] border border-[var(--color-border)] rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] mb-1",children:"Avg QED Score"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400",children:((_=s.avg_qed_score)==null?void 0:_.toFixed(2))??"-"})]}),e.jsxs("div",{className:"bg-[var(--color-surface-elevated)] border border-[var(--color-border)] rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] mb-1",children:"Avg SA Score"}),e.jsx("p",{className:"text-3xl font-bold text-cyan-600 dark:text-cyan-400",children:((w=s.avg_sa_score)==null?void 0:w.toFixed(1))??"-"})]})]}),(s.lipinski_pass_rate!==null||s.safety_pass_rate!==null)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.lipinski_pass_rate!==null&&e.jsxs("div",{className:"bg-[var(--color-surface-elevated)] border border-[var(--color-border)] rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] mb-1",children:"Lipinski Pass Rate"}),e.jsxs("p",{className:`text-3xl font-bold ${(s.lipinski_pass_rate??0)>=80?"text-emerald-600 dark:text-emerald-400":(s.lipinski_pass_rate??0)>=50?"text-amber-600 dark:text-amber-400":"text-red-600 dark:text-red-400"}`,children:[((x=s.lipinski_pass_rate)==null?void 0:x.toFixed(0))??"-","%"]})]}),s.safety_pass_rate!==null&&e.jsxs("div",{className:"bg-[var(--color-surface-elevated)] border border-[var(--color-border)] rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-muted)] mb-1",children:"Safety Pass Rate"}),e.jsxs("p",{className:`text-3xl font-bold ${(s.safety_pass_rate??0)>=80?"text-emerald-600 dark:text-emerald-400":(s.safety_pass_rate??0)>=50?"text-amber-600 dark:text-amber-400":"text-red-600 dark:text-red-400"}`,children:[((S=s.safety_pass_rate)==null?void 0:S.toFixed(0))??"-","%"]})]})]}),e.jsxs("div",{className:"bg-[var(--color-surface-elevated)] border border-[var(--color-border)] rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-[var(--color-text-primary)] mb-4",children:"Score Distribution"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-20 text-sm text-[var(--color-text-secondary)]",children:"Excellent"}),e.jsx("div",{className:"flex-1 h-6 bg-[var(--color-surface-sunken)] rounded-full overflow-hidden mx-3",children:e.jsx("div",{className:"h-full bg-yellow-500 transition-all duration-500",style:{width:`${f.excellent}%`}})}),e.jsx("span",{className:"w-12 text-sm text-right text-[var(--color-text-secondary)]",children:s.score_distribution.excellent})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-20 text-sm text-[var(--color-text-secondary)]",children:"Good"}),e.jsx("div",{className:"flex-1 h-6 bg-[var(--color-surface-sunken)] rounded-full overflow-hidden mx-3",children:e.jsx("div",{className:"h-full bg-amber-500 transition-all duration-500",style:{width:`${f.good}%`}})}),e.jsx("span",{className:"w-12 text-sm text-right text-[var(--color-text-secondary)]",children:s.score_distribution.good})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-20 text-sm text-[var(--color-text-secondary)]",children:"Moderate"}),e.jsx("div",{className:"flex-1 h-6 bg-[var(--color-surface-sunken)] rounded-full overflow-hidden mx-3",children:e.jsx("div",{className:"h-full bg-amber-500 transition-all duration-500",style:{width:`${f.moderate}%`}})}),e.jsx("span",{className:"w-12 text-sm text-right text-[var(--color-text-secondary)]",children:s.score_distribution.moderate})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-20 text-sm text-[var(--color-text-secondary)]",children:"Poor"}),e.jsx("div",{className:"flex-1 h-6 bg-[var(--color-surface-sunken)] rounded-full overflow-hidden mx-3",children:e.jsx("div",{className:"h-full bg-red-500 transition-all duration-500",style:{width:`${f.poor}%`}})}),e.jsx("span",{className:"w-12 text-sm text-right text-[var(--color-text-secondary)]",children:s.score_distribution.poor})]})]}),e.jsxs("div",{className:"mt-3 text-xs text-[var(--color-text-muted)] flex justify-between",children:[e.jsx("span",{children:"90-100"}),e.jsx("span",{children:"70-89"}),e.jsx("span",{children:"50-69"}),e.jsx("span",{children:"0-49"})]})]}),Object.keys(s.alert_summary).length>0&&e.jsxs("div",{className:"bg-amber-500/10 dark:bg-amber-500/20 border border-amber-500/30 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-amber-800 dark:text-amber-400 mb-3",children:"Alert Summary"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(s.alert_summary).map(([c,h])=>e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-semibold text-amber-700 dark:text-amber-400",children:h}),e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-500",children:c})]},c))})]}),Object.keys(s.issue_summary).length>0&&e.jsxs("div",{className:"bg-red-500/10 dark:bg-red-500/20 border border-red-500/30 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 dark:text-red-400 mb-3",children:"Structural Issues"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(s.issue_summary).sort(([,c],[,h])=>h-c).map(([c,h])=>e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-semibold text-red-700 dark:text-red-400",children:h}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-500",children:c.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase())})]},c))})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[u&&u.size>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-1.5 rounded-full bg-[var(--color-primary)]/10 text-[var(--color-primary)] text-sm font-medium",children:[u.size," selected"]}),e.jsxs(V,{variant:"primary",onClick:()=>{n(u),y(!0)},leftIcon:e.jsx(de,{className:"w-4 h-4"}),children:["Export Selected (",u.size,")"]}),i&&e.jsx("button",{onClick:i,className:"text-sm text-[var(--color-text-muted)] hover:text-[var(--color-text-secondary)] transition-colors",children:"Clear"})]}),e.jsx(V,{variant:u&&u.size>0?"default":"primary",onClick:()=>{n(void 0),y(!0)},leftIcon:e.jsx(de,{className:"w-4 h-4"}),className:(u&&u.size>0,"ml-auto"),children:"Export All"})]}),e.jsx(Re,{jobId:t,isOpen:g,onClose:()=>{y(!1),n(void 0)},selectedIndices:o})]})}function Ae({results:t,page:s,pageSize:u,totalResults:i,totalPages:g,filters:y,sortBy:o,sortDir:n,onPageChange:b,onPageSizeChange:k,onFiltersChange:m,onSortChange:f,isLoading:v=!1,selectedIndices:d,onSelectionChange:_}){const[w,x]=r.useState(null),[S,c]=r.useState([]),h=r.useRef(null),p=a=>{o===a?f(a,n==="asc"?"desc":"asc"):f(a,"asc")},$=a=>a==null?"text-[var(--color-text-muted)]":a>=80?"text-amber-600 dark:text-yellow-400 bg-yellow-500/10":a>=50?"text-orange-600 dark:text-orange-400 bg-orange-500/10":"text-red-600 dark:text-red-400 bg-red-500/10",O=(a,L=30)=>a.length<=L?a:a.substring(0,L)+"...",I=t.map(a=>a.index),U=I.length>0&&I.every(a=>d.has(a)),J=I.some(a=>d.has(a))&&!U;r.useEffect(()=>{h.current&&(h.current.indeterminate=J)},[J]);const X=()=>{const a=new Set(d);U?I.forEach(L=>a.delete(L)):I.forEach(L=>a.add(L)),_(a)},ee=(a,L)=>{L.stopPropagation();const R=new Set(d);R.has(a)?R.delete(a):R.add(a),_(R)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 p-4 bg-[var(--color-surface-sunken)] rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm text-[var(--color-text-secondary)]",children:"Status:"}),e.jsxs("select",{value:y.status_filter||"",onChange:a=>m({...y,status_filter:a.target.value||void 0}),className:"border border-[var(--color-border)] bg-[var(--color-surface-elevated)] text-[var(--color-text-primary)] rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"error",children:"Error"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm text-[var(--color-text-secondary)]",children:"Score:"}),e.jsx("input",{type:"number",placeholder:"Min",min:"0",max:"100",value:y.min_score??"",onChange:a=>m({...y,min_score:a.target.value?Number(a.target.value):void 0}),className:"w-16 border border-[var(--color-border)] bg-[var(--color-surface-elevated)] text-[var(--color-text-primary)] rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"}),e.jsx("span",{className:"text-[var(--color-text-muted)]",children:"-"}),e.jsx("input",{type:"number",placeholder:"Max",min:"0",max:"100",value:y.max_score??"",onChange:a=>m({...y,max_score:a.target.value?Number(a.target.value):void 0}),className:"w-16 border border-[var(--color-border)] bg-[var(--color-surface-elevated)] text-[var(--color-text-primary)] rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]}),e.jsxs("div",{className:"ml-auto text-sm text-[var(--color-text-muted)]",children:["Showing ",t.length," of ",i," results"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[var(--color-surface-sunken)]",children:[e.jsx("th",{className:"w-10 px-4 py-3 text-center",children:e.jsx("input",{ref:h,type:"checkbox",checked:U,onChange:X,className:"w-4 h-4 cursor-pointer accent-[var(--color-primary)]","aria-label":"Select all on page"})}),e.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-[var(--color-text-muted)] uppercase cursor-pointer hover:bg-[var(--color-surface-elevated)]",onClick:()=>p("index"),children:["# ",o==="index"&&(n==="asc"?"â†‘":"â†“")]}),e.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-[var(--color-text-muted)] uppercase cursor-pointer hover:bg-[var(--color-surface-elevated)]",onClick:()=>p("name"),children:["Name ",o==="name"&&(n==="asc"?"â†‘":"â†“")]}),e.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-[var(--color-text-muted)] uppercase cursor-pointer hover:bg-[var(--color-surface-elevated)]",onClick:()=>p("smiles"),children:["SMILES ",o==="smiles"&&(n==="asc"?"â†‘":"â†“")]}),e.jsxs("th",{className:"px-4 py-3 text-center text-xs font-medium text-[var(--color-text-muted)] uppercase cursor-pointer hover:bg-[var(--color-surface-elevated)]",onClick:()=>p("score"),children:["Score ",o==="score"&&(n==="asc"?"â†‘":"â†“")]}),e.jsxs("th",{className:"px-4 py-3 text-center text-xs font-medium text-[var(--color-text-muted)] uppercase cursor-pointer hover:bg-[var(--color-surface-elevated)]",onClick:()=>p("qed"),children:["QED ",o==="qed"&&(n==="asc"?"â†‘":"â†“")]}),e.jsxs("th",{className:"px-4 py-3 text-center text-xs font-medium text-[var(--color-text-muted)] uppercase cursor-pointer hover:bg-[var(--color-surface-elevated)]",onClick:()=>p("safety"),children:["Safety ",o==="safety"&&(n==="asc"?"â†‘":"â†“")]}),e.jsxs("th",{className:"px-4 py-3 text-center text-xs font-medium text-[var(--color-text-muted)] uppercase cursor-pointer hover:bg-[var(--color-surface-elevated)]",onClick:()=>p("status"),children:["Status ",o==="status"&&(n==="asc"?"â†‘":"â†“")]}),e.jsxs("th",{className:"px-4 py-3 text-center text-xs font-medium text-[var(--color-text-muted)] uppercase cursor-pointer hover:bg-[var(--color-surface-elevated)]",onClick:()=>p("issues"),children:["Issues ",o==="issues"&&(n==="asc"?"â†‘":"â†“")]})]})}),e.jsx("tbody",{className:"divide-y divide-[var(--color-border)]",children:v?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,className:"px-4 py-8 text-center text-[var(--color-text-muted)]",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[var(--color-primary)] mx-auto mb-2"}),"Loading results..."]})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-8 text-center text-[var(--color-text-muted)]",children:"No results match the current filters."})}):t.map(a=>{var L,R,Z,Q,K,H,B,N,C,F,Y,ae,l,E,M,A,q,le;return e.jsxs(r.Fragment,{children:[e.jsxs("tr",{className:`
                      hover:bg-[var(--color-surface-sunken)] cursor-pointer transition-colors
                      ${a.status==="error"?"bg-red-500/5":""}
                      ${w===a.index?"bg-[var(--color-primary)]/5":""}
                    `,onClick:()=>{x(w===a.index?null:a.index),c([])},children:[e.jsx("td",{className:"px-4 py-3 text-center",onClick:j=>j.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:d.has(a.index),onChange:j=>ee(a.index,j),className:"w-4 h-4 cursor-pointer accent-[var(--color-primary)]","aria-label":`Select molecule ${a.index+1}`})}),e.jsx("td",{className:"px-4 py-3 text-sm text-[var(--color-text-muted)]",children:a.index+1}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-[var(--color-text-primary)]",children:a.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-[var(--color-text-secondary)] font-mono",children:O(a.smiles)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${$((L=a.validation)==null?void 0:L.overall_score)}`,children:((R=a.validation)==null?void 0:R.overall_score)??"-"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:(Z=a.scoring)!=null&&Z.druglikeness?e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-purple-500/10 text-purple-600 dark:text-purple-400",children:a.scoring.druglikeness.qed_score.toFixed(2)}):e.jsx("span",{className:"text-[var(--color-text-muted)]",children:"-"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:(()=>{var G,W,te;const j=((G=a.alerts)==null?void 0:G.alert_count)??0;return j===0&&((te=(W=a.scoring)==null?void 0:W.safety_filters)==null?void 0:te.all_passed)!==!1?e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-emerald-500/10 text-emerald-600 dark:text-emerald-400",children:"âœ“"}):e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-red-500/10 text-red-600 dark:text-red-400",children:j})})()}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${a.status==="success"?"bg-yellow-500/10 text-amber-700 dark:text-yellow-400":"bg-red-500/10 text-red-700 dark:text-red-400"}`,children:a.status})}),e.jsx("td",{className:"px-4 py-3 text-center",children:(()=>{var W,te;const j=((te=(W=a.validation)==null?void 0:W.issues)==null?void 0:te.filter(oe=>!oe.passed))??[],P=j.length;if(P===0)return e.jsx("span",{className:"text-[var(--color-text-muted)]",children:"0"});const G=j.some(oe=>oe.severity==="error");return e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${G?"bg-red-500/10 text-red-600 dark:text-red-400":"bg-amber-500/10 text-amber-700 dark:text-amber-400"}`,children:P})})()})]}),w===a.index&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-0",children:e.jsxs("div",{className:"px-3 py-3 bg-[var(--color-surface-sunken)] border-t border-[var(--color-border)]",children:[a.error&&e.jsxs("div",{className:"mb-2 rounded-xl bg-red-500/10 dark:bg-red-500/15 border border-red-500/20 p-2.5 flex items-center gap-2.5",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ie,{className:"w-4 h-4 text-red-500"})}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:a.error})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_1fr_320px] gap-2 auto-rows-auto",children:[e.jsxs("div",{className:D("card rounded-xl p-3 border-l-[3px]",(K=(Q=a.validation)==null?void 0:Q.issues)!=null&&K.length?a.validation.issues.some(j=>j.severity==="error")?"border-l-red-500":"border-l-amber-500":"border-l-emerald-500"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-gradient-to-br from-amber-500/15 to-red-500/10 flex items-center justify-center",children:e.jsx(ie,{className:"w-3.5 h-3.5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-semibold text-[var(--color-text-primary)] tracking-tight",children:"Validation Issues"}),e.jsxs("p",{className:"text-[10px] text-[var(--color-text-muted)]",children:[((B=(H=a.validation)==null?void 0:H.issues)==null?void 0:B.length)??0," found"]})]})]}),(N=a.validation)!=null&&N.issues&&a.validation.issues.length>0?e.jsx("ul",{className:"space-y-1",children:a.validation.issues.map((j,P)=>e.jsxs("li",{className:"flex items-start gap-2 text-[12px] cursor-default rounded-lg px-2 py-1 hover:bg-[var(--color-surface-sunken)] transition-colors",onMouseEnter:()=>c(j.affected_atoms??[]),onMouseLeave:()=>c([]),children:[e.jsx("span",{className:D("w-1.5 h-1.5 mt-[7px] rounded-full flex-shrink-0",j.severity==="error"?"bg-red-500":"bg-amber-500")}),e.jsx("span",{className:"flex-1 text-[var(--color-text-secondary)] leading-snug",children:j.message}),j.affected_atoms&&j.affected_atoms.length>0&&e.jsx(pe,{className:"w-3 h-3 text-[var(--color-text-muted)] flex-shrink-0 mt-0.5"})]},P))}):e.jsx("p",{className:"text-[12px] text-emerald-600 dark:text-emerald-400 flex items-center gap-1.5 px-2 py-1",children:"No structural issues detected"})]}),e.jsxs("div",{className:D("card rounded-xl p-3 border-l-[3px]",(((C=a.alerts)==null?void 0:C.alert_count)??0)>0?"border-l-red-500":"border-l-emerald-500"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-gradient-to-br from-red-500/15 to-rose-500/10 flex items-center justify-center",children:e.jsx(Se,{className:"w-3.5 h-3.5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-semibold text-[var(--color-text-primary)] tracking-tight",children:"Safety Alerts"}),e.jsxs("p",{className:"text-[10px] text-[var(--color-text-muted)]",children:[((F=a.alerts)==null?void 0:F.alert_count)??0," flagged"]})]})]}),(Y=a.alerts)!=null&&Y.alerts&&a.alerts.alerts.length>0?e.jsxs("div",{className:"space-y-1",children:[a.alerts.alerts.map((j,P)=>e.jsxs("div",{className:"flex items-center gap-2 text-[12px] cursor-default rounded-lg px-2 py-1 hover:bg-[var(--color-surface-sunken)] transition-colors",onMouseEnter:()=>c(j.matched_atoms??[]),onMouseLeave:()=>c([]),children:[e.jsx("span",{className:D("inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-semibold shrink-0 uppercase tracking-wide",j.severity==="critical"?"bg-red-500/20 text-red-600 dark:text-red-400":"bg-amber-500/15 text-amber-700 dark:text-amber-400"),children:j.catalog}),e.jsx("span",{className:"text-[var(--color-text-secondary)] truncate",children:j.rule_name}),j.matched_atoms&&j.matched_atoms.length>0&&e.jsx(pe,{className:"w-3 h-3 text-[var(--color-text-muted)] flex-shrink-0 ml-auto"})]},P)),((ae=a.scoring)==null?void 0:ae.safety_filters)&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-[var(--color-border)] text-[11px] text-[var(--color-text-muted)] flex flex-wrap gap-x-3 gap-y-0.5 px-2",children:[e.jsxs("span",{children:["PAINS: ",a.scoring.safety_filters.pains_passed?"âœ“":"âœ—"]}),e.jsxs("span",{children:["Brenk: ",a.scoring.safety_filters.brenk_passed?"âœ“":"âœ—"]}),a.scoring.safety_filters.nih_passed!==void 0&&e.jsxs("span",{children:["NIH: ",a.scoring.safety_filters.nih_passed?"âœ“":"âœ—"]}),a.scoring.safety_filters.zinc_passed!==void 0&&e.jsxs("span",{children:["ZINC: ",a.scoring.safety_filters.zinc_passed?"âœ“":"âœ—"]}),a.scoring.safety_filters.chembl_passed!==void 0&&e.jsxs("span",{children:["ChEMBL: ",a.scoring.safety_filters.chembl_passed?"âœ“":"âœ—"]})]})]}):e.jsx("p",{className:"text-[12px] text-emerald-600 dark:text-emerald-400 flex items-center gap-1.5 px-2 py-1",children:"All safety screens passed"})]}),e.jsx("div",{className:"card-glass rounded-xl p-3 lg:row-span-2 flex flex-col",children:a.status==="success"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-gradient-to-br from-[var(--color-primary)]/15 to-[var(--color-accent)]/10 flex items-center justify-center",children:e.jsx(ye,{className:"w-3.5 h-3.5 text-[var(--color-primary)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("h4",{className:"text-xs font-semibold text-[var(--color-text-primary)] tracking-tight",children:"Structure"}),((l=a.standardization)==null?void 0:l.standardized_smiles)&&a.standardization.changed&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-medium bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 uppercase tracking-wide",children:"Standardized"})]}),a.name&&e.jsx("p",{className:"text-[10px] text-[var(--color-text-muted)] truncate",children:a.name})]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center rounded-xl bg-white dark:bg-gray-900/50 border border-[var(--color-border-subtle)] min-h-[180px]",children:e.jsx(_e,{smiles:((E=a.standardization)==null?void 0:E.standardized_smiles)||a.smiles,highlightAtoms:S,width:280,height:220})}),S.length>0&&e.jsx("div",{className:"mt-1.5 flex justify-center",children:e.jsx("div",{className:"px-2.5 py-0.5 rounded-full bg-[var(--color-primary)]/10 border border-[var(--color-primary)]/20",children:e.jsxs("p",{className:"text-[10px] font-medium text-[var(--color-primary)] whitespace-nowrap",children:[S.length," atom",S.length!==1?"s":""," highlighted"]})})}),(M=a.standardization)!=null&&M.standardized_smiles&&a.standardization.changed?e.jsxs("div",{className:"mt-2 space-y-1.5",children:[e.jsxs("div",{className:"rounded-lg bg-[var(--color-surface-sunken)] border border-[var(--color-border-subtle)] px-2.5 py-1.5",children:[e.jsx("p",{className:"text-[9px] font-medium text-[var(--color-text-muted)] uppercase tracking-wide mb-0.5",children:"Original"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("p",{className:"text-[11px] font-mono text-[var(--color-text-secondary)] break-all flex-1 leading-relaxed",children:a.smiles}),e.jsx(ce,{text:a.smiles,size:13,className:"mt-0.5 flex-shrink-0"})]})]}),e.jsxs("div",{className:"rounded-lg bg-emerald-500/5 border border-emerald-500/20 px-2.5 py-1.5",children:[e.jsx("p",{className:"text-[9px] font-medium text-emerald-600 dark:text-emerald-400 uppercase tracking-wide mb-0.5",children:"Standardized"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("p",{className:"text-[11px] font-mono text-[var(--color-text-secondary)] break-all flex-1 leading-relaxed",children:a.standardization.standardized_smiles}),e.jsx(ce,{text:a.standardization.standardized_smiles,size:13,className:"mt-0.5 flex-shrink-0"})]})]})]}):e.jsxs("div",{className:"mt-2 flex items-start gap-2 rounded-lg bg-[var(--color-surface-sunken)] border border-[var(--color-border-subtle)] px-2.5 py-1.5",children:[e.jsx("p",{className:"text-[11px] font-mono text-[var(--color-text-secondary)] break-all flex-1 leading-relaxed",children:a.smiles}),e.jsx(ce,{text:a.smiles,size:13,className:"mt-0.5 flex-shrink-0"})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center rounded-xl bg-red-500/5 border border-red-500/10 min-h-[180px]",children:e.jsx("p",{className:"text-sm text-red-500/70",children:"Parse failed"})})}),a.scoring&&e.jsxs("div",{className:"card rounded-xl p-3 lg:col-span-2",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[a.scoring.ml_readiness&&e.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-[var(--color-primary)]/[0.07] to-transparent border border-[var(--color-border-subtle)] p-2.5 text-center",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-[var(--color-text-muted)] font-medium mb-0.5",children:"ML-Readiness"}),e.jsx("p",{className:"text-xl font-bold text-gradient",children:a.scoring.ml_readiness.score})]}),a.scoring.druglikeness&&e.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-purple-500/[0.07] to-transparent border border-[var(--color-border-subtle)] p-2.5 text-center",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-[var(--color-text-muted)] font-medium mb-0.5",children:"QED Score"}),e.jsx("p",{className:"text-xl font-bold text-purple-600 dark:text-purple-400",children:a.scoring.druglikeness.qed_score.toFixed(2)}),e.jsxs("p",{className:D("text-[10px] font-medium mt-0.5",a.scoring.druglikeness.lipinski_passed?"text-emerald-600 dark:text-emerald-400":"text-red-600 dark:text-red-400"),children:["Lipinski: ",a.scoring.druglikeness.lipinski_passed?"Pass":"Fail"]})]}),(a.scoring.safety_filters||((A=a.alerts)==null?void 0:A.alerts)&&a.alerts.alerts.length>0)&&e.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-emerald-500/[0.07] to-transparent border border-[var(--color-border-subtle)] p-2.5 text-center",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-[var(--color-text-muted)] font-medium mb-0.5",children:"Safety"}),(()=>{var G,W;const j=((G=a.alerts)==null?void 0:G.alert_count)??0,P=j===0&&((W=a.scoring.safety_filters)==null?void 0:W.all_passed)!==!1;return e.jsx("p",{className:D("text-xl font-bold",P?"text-emerald-600 dark:text-emerald-400":"text-red-600 dark:text-red-400"),children:P?"Clear":j})})(),e.jsx("p",{className:"text-[10px] text-[var(--color-text-muted)] mt-0.5",children:(((q=a.alerts)==null?void 0:q.alert_count)??0)===0?"No alerts":"alerts flagged"})]}),a.scoring.admet&&e.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-cyan-500/[0.07] to-transparent border border-[var(--color-border-subtle)] p-2.5 text-center",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-[var(--color-text-muted)] font-medium mb-0.5",children:"Synth. Access."}),e.jsx("p",{className:"text-xl font-bold text-cyan-600 dark:text-cyan-400",children:a.scoring.admet.sa_score.toFixed(1)}),e.jsxs("p",{className:"text-[10px] text-[var(--color-text-muted)] mt-0.5",children:[a.scoring.admet.sa_classification," | Fsp3: ",a.scoring.admet.fsp3.toFixed(2)]})]})]}),((le=a.scoring.ml_readiness)==null?void 0:le.interpretation)&&e.jsx("p",{className:"text-[11px] text-[var(--color-text-secondary)] mt-2 px-1 leading-snug",children:a.scoring.ml_readiness.interpretation})]})]})]})})})]},a.index)})})]})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-[var(--color-surface-sunken)] rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm text-[var(--color-text-secondary)]",children:"Per page:"}),e.jsxs("select",{value:u,onChange:a=>k(Number(a.target.value)),className:"border border-[var(--color-border)] bg-[var(--color-surface-elevated)] text-[var(--color-text-primary)] rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]",children:[e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>b(s-1),disabled:s<=1,className:"px-3 py-1 border border-[var(--color-border)] rounded text-sm text-[var(--color-text-secondary)] disabled:opacity-50 disabled:cursor-not-allowed hover:bg-[var(--color-surface-elevated)] transition-colors",children:"Previous"}),e.jsxs("span",{className:"text-sm text-[var(--color-text-secondary)]",children:["Page ",s," of ",g]}),e.jsx("button",{onClick:()=>b(s+1),disabled:s>=g,className:"px-3 py-1 border border-[var(--color-border)] rounded text-sm text-[var(--color-text-secondary)] disabled:opacity-50 disabled:cursor-not-allowed hover:bg-[var(--color-surface-elevated)] transition-colors",children:"Next"})]})]})]})}function Ie(t){const[s,u]=r.useState(null),[i,g]=r.useState(!1),[y,o]=r.useState(null),n=r.useRef(null),b=r.useRef(0),k=r.useRef(null),m=r.useRef(!1),f=3;r.useEffect(()=>{if(!t){u(null),g(!1),o(null),m.current=!1,n.current&&(n.current.close(),n.current=null),k.current&&(clearTimeout(k.current),k.current=null);return}m.current=!1,b.current=0;const d=()=>{n.current&&(n.current.close(),n.current=null);const _=window.location.protocol==="https:"?"wss:":"ws:",w=window.location.hostname,x=window.location.port,S=`${_}//${w}:${x}/ws/batch/${t}`;try{const c=new WebSocket(S);n.current=c,c.onopen=()=>{g(!0),o(null),b.current=0},c.onclose=h=>{g(!1),!m.current&&!h.wasClean&&b.current<f&&(b.current+=1,k.current=setTimeout(d,1e3*b.current))},c.onerror=()=>{o("WebSocket connection error")},c.onmessage=h=>{try{const p=JSON.parse(h.data);u(p),(p.status==="complete"||p.status==="failed"||p.status==="cancelled")&&(m.current=!0,setTimeout(()=>{n.current&&(n.current.close(),n.current=null)},500))}catch(p){console.error("Failed to parse WebSocket message:",p)}}}catch{o("Failed to create WebSocket connection")}};return d(),()=>{k.current&&(clearTimeout(k.current),k.current=null),n.current&&(n.current.close(),n.current=null)}},[t]);const v=r.useCallback(()=>{m.current=!0,k.current&&(clearTimeout(k.current),k.current=null),n.current&&(n.current.close(),n.current=null),g(!1)},[]);return{progress:s,isConnected:i,error:y,close:v}}function Te(){const t=ge(),[s,u]=r.useState("upload"),[i,g]=r.useState(null),[y,o]=r.useState(null),[n,b]=r.useState(null),[k,m]=r.useState(!1),[f,v]=r.useState(1),[d,_]=r.useState(50),[w,x]=r.useState({}),[S,c]=r.useState("index"),[h,p]=r.useState("asc"),[$,O]=r.useState(new Set),{progress:I,isConnected:U}=Ie(s==="processing"?i:null),J=r.useCallback((N,C)=>{g(N),o(null),u("processing")},[]),X=r.useCallback(N=>{o(N)},[]),ee=r.useCallback(async()=>{if(i){m(!0);try{const N=await T.getBatchResults(i,1,d,{});b(N),v(1),x({}),u("results")}catch(N){o(N.message||"Failed to load results")}finally{m(!1)}}},[i,d]),a=r.useCallback(async()=>{if(i)try{await T.cancelBatch(i)}catch{}},[i]),L=r.useCallback(async N=>{if(i){m(!0);try{const C={...w,sort_by:S,sort_dir:h},F=await T.getBatchResults(i,N,d,C);b(F),v(N)}catch(C){o(C.message||"Failed to load results")}finally{m(!1)}}},[i,d,w,S,h]),R=r.useCallback(async N=>{if(i){m(!0);try{const C={...w,sort_by:S,sort_dir:h},F=await T.getBatchResults(i,1,N,C);b(F),v(1),_(N)}catch(C){o(C.message||"Failed to load results")}finally{m(!1)}}},[i,w,S,h]),Z=r.useCallback(async N=>{if(i){m(!0);try{const C={...N,sort_by:S,sort_dir:h},F=await T.getBatchResults(i,1,d,C);b(F),v(1),x(C)}catch(C){o(C.message||"Failed to load results")}finally{m(!1)}}},[i,d,S,h]),Q=r.useCallback(async(N,C)=>{if(i){m(!0);try{const F={...w,sort_by:N,sort_dir:C},Y=await T.getBatchResults(i,1,d,F);b(Y),v(1),c(N),p(C),x(F)}catch(F){o(F.message||"Failed to load results")}finally{m(!1)}}},[i,d,w]),K=r.useCallback(N=>{O(N)},[]),H=r.useCallback(()=>{O(new Set)},[]),B=r.useCallback(()=>{u("upload"),g(null),o(null),b(null),v(1),x({}),c("index"),p("asc"),O(new Set)},[]);return e.jsxs("div",{className:D("mx-auto space-y-8 px-4 sm:px-6",s==="results"?"max-w-[1600px]":"max-w-7xl"),children:[e.jsxs(z.div,{className:"text-center pt-4",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6,ease:[.25,.46,.45,.94]},children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-[var(--color-primary)]/10 border border-[var(--color-primary)]/20 mb-4",children:[e.jsx(re,{className:"w-4 h-4 text-[var(--color-primary)]"}),e.jsx("span",{className:"text-sm font-medium text-[var(--color-primary)]",children:"High-throughput Processing"})]}),e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-gradient tracking-tight font-display",children:"Batch Validation"}),e.jsxs("p",{className:"text-[var(--color-text-secondary)] mt-3 text-base sm:text-lg max-w-2xl mx-auto",children:["Validate up to ",e.jsxs("span",{className:"font-semibold text-[var(--color-text-primary)]",children:[t.max_batch_size.toLocaleString()," molecules"]})," at once from SDF or CSV files"]}),t.max_batch_size>=5e4&&e.jsxs(z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"inline-flex items-center gap-2 mt-4 px-4 py-2 rounded-lg bg-amber-500/10 border border-amber-500/20 text-amber-600 dark:text-amber-400",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Large batches may take several minutes to process"})]})]}),e.jsx(ve,{children:y&&e.jsx(z.div,{initial:{opacity:0,y:-10,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.98},className:"card p-5 border-red-500/30 bg-red-500/5",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-500/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ie,{className:"w-5 h-5 text-red-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-600 dark:text-red-400 mb-1 font-display",children:"Error Occurred"}),e.jsx("p",{className:"text-sm text-[var(--color-text-secondary)]",children:y})]}),e.jsx("button",{onClick:()=>o(null),className:"p-2 rounded-lg hover:bg-red-500/10 transition-colors",children:e.jsx(je,{className:"w-5 h-5 text-red-500"})})]})})}),e.jsxs(ve,{mode:"wait",children:[s==="upload"&&e.jsxs(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4},children:[e.jsxs("div",{className:"card-glass p-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-[var(--color-primary)]/20 to-[var(--color-accent)]/10 flex items-center justify-center text-[var(--color-primary)]",children:e.jsx(xe,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-[var(--color-text-primary)] text-lg font-display",children:"Upload Your File"}),e.jsx("p",{className:"text-sm text-[var(--color-text-muted)]",children:"Supported formats: SDF, CSV (with SMILES column)"})]})]}),e.jsx(Pe,{onUploadSuccess:J,onUploadError:X})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[e.jsx(ne,{icon:e.jsx(fe,{className:"w-5 h-5"}),title:"ML-Readiness Scoring",description:"Automated quality assessment for ML datasets"}),e.jsx(ne,{icon:e.jsx(re,{className:"w-5 h-5"}),title:"Multiple Export Formats",description:"CSV, JSON, Excel, SDF, and PDF reports"}),e.jsx(ne,{icon:e.jsx(Le,{className:"w-5 h-5"}),title:"Real-time Progress",description:"WebSocket-powered live updates"})]})]},"upload"),s==="processing"&&e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4},children:e.jsx($e,{progress:I,isConnected:U,onCancel:a,onComplete:ee})},"processing"),s==="results"&&n&&e.jsxs(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4},className:"space-y-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(V,{variant:"primary",onClick:B,leftIcon:e.jsx(Ee,{className:"w-4 h-4"}),children:"Start New Batch"})}),n.statistics&&i&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-[var(--color-primary)]/10 to-[var(--color-accent)]/10 flex items-center justify-center text-[var(--color-primary)]",children:e.jsx(fe,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--color-text-primary)] font-display",children:"Validation Summary"}),e.jsx("p",{className:"text-xs text-[var(--color-text-muted)]",children:"Overview of batch processing results"})]})]}),e.jsx(De,{jobId:i,statistics:n.statistics,selectedIndices:$,onClearSelection:H})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-[var(--color-accent)]/10 to-[var(--color-primary)]/10 flex items-center justify-center text-[var(--color-accent)]",children:e.jsx(re,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--color-text-primary)] font-display",children:"Detailed Results"}),e.jsxs("p",{className:"text-xs text-[var(--color-text-muted)]",children:[n.total_results.toLocaleString()," molecules processed"]})]})]}),e.jsx(Ae,{results:n.results,page:f,pageSize:d,totalResults:n.total_results,totalPages:n.total_pages,filters:w,sortBy:S,sortDir:h,onPageChange:L,onPageSizeChange:R,onFiltersChange:Z,onSortChange:Q,isLoading:k,selectedIndices:$,onSelectionChange:K})]})]},"results")]})]})}function ne({icon:t,title:s,description:u}){return e.jsxs(z.div,{className:D("p-5 rounded-2xl","bg-[var(--color-surface-elevated)] border border-[var(--color-border)]","hover:border-[var(--color-primary)]/30 hover:shadow-[0_0_20px_var(--glow-soft)]","transition-all duration-300"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{y:-2},children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-[var(--color-primary)]/10 to-[var(--color-accent)]/10 flex items-center justify-center text-[var(--color-primary)] mb-3",children:t}),e.jsx("h4",{className:"font-semibold text-[var(--color-text-primary)] text-sm font-display mb-1",children:s}),e.jsx("p",{className:"text-xs text-[var(--color-text-muted)]",children:u})]})}export{Te as BatchValidationPage};
